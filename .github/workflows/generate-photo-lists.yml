name: Auto-generate photo lists for gallery

on:
  push:
    paths:
      - 'Photography Grid/Lex2026SeniorPics/**'
  workflow_dispatch:

jobs:
  generate-lists:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v5

      - name: Generate lex2026SeniorPics photo list
        run: |
          echo "=== Debug: Current directory & root listing ==="
          pwd
          ls -la

          IMAGE_DIR="Photography Grid/Lex2026SeniorPics"

          echo ""
          echo "=== Checking directory existence ==="
          if [ ! -d "$IMAGE_DIR" ]; then
            echo "ERROR: Directory '$IMAGE_DIR' not found!"
            echo "Listing items that look similar in parent dir:"
            ls -la "Photography Grid" 2>/dev/null || ls -la .
            exit 1
          fi

          echo "Directory found: $IMAGE_DIR"
          echo ""
          echo "=== Directory contents ==="
          ls -la "$IMAGE_DIR"

          echo ""
          echo "=== Finding images (case-insensitive) ==="

          # Collect filenames only (-printf '%f\n') → one per line, sorted naturally
          mapfile -t files < <(
            find "$IMAGE_DIR" -maxdepth 1 -type f \
              \( -iname '*.webp' -o -iname '*.jpg' -o -iname '*.jpeg' -o -iname '*.png' \) \
              -printf '%f\n' 2>/dev/null | sort -V
          )

          echo "Found ${#files[@]} image files"

          if [ ${#files[@]} -eq 0 ]; then
            echo "→ No images found → creating empty array"
            cat > lex2026-images.js << 'EOF'
          const lex2026Images = [];
          export default lex2026Images;
          EOF
          else
            echo "→ Generating JS with the following files:"
            printf '  - %s\n' "${files[@]}"

            {
              echo "const lex2026Images = ["
              printf "  '%s',\n" "${files[@]}"
              echo "];"
              echo ""
              echo "export default lex2026Images;"
            } > lex2026-images.js
          fi

          echo ""
          echo "=== Generated file preview ==="
          cat lex2026-images.js

      - name: Commit changes if any
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "chore: auto-update lex2026SeniorPics image list"
          file_pattern: lex2026-images.js
          disable_globbing: true
          skip_dirty_check: false
          branch: main
